{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container mt-5">

  <h2 class="mb-4">Resumen del Pedido</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  {% if order and order.items.all %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Producto</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for order_item in order.items.all %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>
                <strong>{{ order_item.item.title }}</strong>
                <div class="text-muted small">{{ order_item.item.description|truncatechars:80 }}</div>
              </td>
              <td>${{ order_item.item.price }}</td>
              <td>{{ order_item.quantity }}</td>
              <td>${{ order_item.get_final_price }}</td>
              <td>
                <a class="btn btn-sm btn-success" href="{% url 'core:add-to-cart' order_item.item.slug %}">+1</a>
                <a class="btn btn-sm btn-warning" href="{% url 'core:remove-single-item-from-cart' order_item.item.slug %}">-1</a>
                <a class="btn btn-sm btn-danger" href="{% url 'core:remove-from-cart' order_item.item.slug %}">Eliminar</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3">
      <h4>Total: ${{ order.get_total }}</h4>

      <a href="{% url 'core:payment' %}" class="btn btn-primary btn-lg">
        Pagar con MercadoPago
      </a>
    </div>

  {% else %}
    <div class="text-center py-5">
      <h4>Tu carrito está vacío</h4>
      <a href="{% url 'core:home' %}" class="btn btn-outline-primary mt-3">Seguir comprando</a>
    </div>
  {% endif %}

</div>

{% endblock %}
